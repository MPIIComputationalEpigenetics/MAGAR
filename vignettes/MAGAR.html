<h1 id="introduction">Introduction</h1>
<p>This vignette describes the package &quot;Methylation-Aware Genotype Association with R* (<a href="https://github.com/MPIIComputationalEpigenetics/MAGAR"><em>MAGAR</em></a>) available from GitHub. <em>MAGAR</em> uses DNA methylation data obtained using the Illumina BeadArrays, and genotyping data from Illumina genotyping microarrays or whole genome sequencing to compute methylation quantitative trait loci (methQTL). The package provides mutliple flavors of linear modeling strategies to compute <em>methQTL</em> as statistically significant interactions between single nucleotide polymorphisms (SNPs) and changes in the DNA methylation state of individual CpGs. DNA methylation values at single CpGs are first summarized into correlation blocks, and a representative of this correlation block (tag-CpG) is used in the methQTL calling.</p>
<h1 id="installation">Installation</h1>
<p>The package relies on some dependencies that are exclusively available from Bioconductor and not from CRAN, most notably <a href="https://rnbeads.org"><em>RnBeads</em></a>. After installing the dependencies, <em>MAGAR</em> can be installed from GitHub, after installing the <em>devtools</em> package.</p>
<h2 id="required-external-software-tools">Required external software tools</h2>
<p><em>MAGAR</em> depends on a funtional installation of <em>PLINK</em> for handling genotyping data. Follow the installation instructions available <a href="https://www.cog-genomics.org/plink2/">here</a> and specify the path to the installation for the package:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">qtlSetOption</span>(<span class="dt">plink.path=</span><span class="st">&quot;path_to_plink&quot;</span>)</a></code></pre></div>
<pre><code>## Error in qtlSetOption(plink.path = &quot;path_to_plink&quot;): could not find function &quot;qtlSetOption&quot;</code></pre>
<p>Additionally, depending on the type of the analysis, more external software tools are required. More specifically, if you want to perform imputation <em>bgzip</em> and <em>tabix</em> from the <a href="http://www.htslib.org/download/"><em>htslib</em></a> package are needed, as well as <a href="http://vcftools.sourceforge.net/downloads.html"><em>vcftools</em></a> for sorting VCF files. Lastly, if methQTL calling is to be performed through <a href="http://fastqtl.sourceforge.net/"><em>fastQTL</em></a>, the software tool needs to be installed and the location of the executable specified to <em>MAGAR</em>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">qtlSetOption</span>(</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">    <span class="dt">bgzip.path=</span><span class="st">&quot;path_to_bgzip&quot;</span>,</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">    <span class="dt">tabix.path=</span><span class="st">&quot;path_to_tabix&quot;</span>,</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">    <span class="dt">vctools.path=</span><span class="st">&quot;path_to_vcftools_folder&quot;</span>,</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">    <span class="dt">fast.qtl.path=</span><span class="st">&quot;path_to_fastQTL&quot;</span>,</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">)</a></code></pre></div>
<h1 id="input-data">Input data</h1>
<p><em>MAGAR</em> uses two types of data as input: DNA methylation data obtained using the Illumina Infinium BeadArrays or bisulfite sequencing and genotyping data obtained using genotyping microarrays or whole genome sequencing.</p>
<h2 id="dna-methylation-data-microarrays">DNA methylation data (microarrays)</h2>
<p><em>MAGAR</em> utilizes the widely used <a href="http://rnbeads.org/"><em>RnBeads</em></a> software package for DNA methylation data import. Thus, <em>MAGAR</em> supports the various input options available in <em>RnBeads</em>, including a direct download from the Gene Expression Omnibus (GEO), IDAT, and BED files. For further options, we refer to the <a href="http://bioconductor.org/packages/release/bioc/vignettes/RnBeads/inst/doc/RnBeads.pdf">RnBeads vignette</a> and documentation. In addition to the raw methylation data, a sample annotation sheet specifying the samples to be analyzed needs to be provided. The sheet contains a line for each sample and looks as follows:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="ex">SampleID</span>,age,sex,barcode</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="ex">Sample_1</span>,14,f,209054857842_R01C01</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="ex">Sample_2</span>,42,f,209054857842_R02C01</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="ex">Sample_3</span>,45,m,209054857842_R03C01</a></code></pre></div>
<p>For further details on the import process, we refer to the <a href="http://bioconductor.org/packages/release/bioc/vignettes/RnBeads/inst/doc/RnBeads.pdf">RnBeads vignette</a>. Most importantly, analysis options need to be specified for the import and preprocessing modules of <em>RnBeads</em>. <em>MAGAR</em> provides a default setting, which is available in <em>extdata/rnbeads_options.xml</em>. You can use this file as a template for your own setting and then specify it to the package:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">opts &lt;-<span class="st"> </span><span class="kw">rnb.xml2options</span>(<span class="kw">system.file</span>(<span class="st">&quot;extdata/rnbeads_options.xml&quot;</span>,<span class="dt">package=</span><span class="st">&quot;methQTL&quot;</span>))</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw">rnb.options</span>(<span class="dt">identifiers.column=</span><span class="st">&quot;geo_accession&quot;</span>,</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">    <span class="dt">import.idat.platform=</span><span class="st">&quot;probes450&quot;</span>)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">xml.fi &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="kw">getwd</span>(),<span class="st">&quot;rnbeads_options.xml&quot;</span>)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="kw">cat</span>(<span class="kw">rnb.options2xml</span>(),<span class="dt">file=</span>xml.fi)</a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="kw">qtlSetOption</span>(<span class="dt">rnbeads.options =</span> xml.fi)</a></code></pre></div>
<p>To redefine the correlation blocks, we allow for including additional information such as genome-wide segmentation of the methylation landscape (see option <code>use.segmentation</code> and function <code>qtlRunSegmentation</code>), and also functional annotation according to the Ensembl regulatory build <span class="citation" data-cites="Zerbino2015">[@Zerbino2015]</span>.</p>
<h2 id="genotyping-data">Genotyping data</h2>
<h3 id="plink-files">PLINK files</h3>
<p><em>MAGAR</em> supports data that has already been processed by <a href="http://zzz.bwh.harvard.edu/plink/"><em>PLINK</em></a> and that is available either in the form of binary <em>.bed</em>, <em>.bim</em> and <em>.fam</em> files, as <em>.ped</em> and <em>.map</em>, as variant calling files (<em>.vcf</em>), or as imputed files in the dosage format (<em>.dos</em>). For further processing, we use the command line tool <em>PLINK</em>, which is shipped together with <em>MAGAR</em>. However, this installation is only valid for Linux systems. For Windows and MacOS users, please install the <em>PLINK</em> tool from <a href="https://www.cog-genomics.org/plink/1.9/">here</a> and specify it using the option <code>plink.path</code>. The sample identifier specified earlier also needs to match the sample IDs of the genotype calls.</p>
<h3 id="idat-files">IDAT files</h3>
<p><em>MAGAR</em> also supports raw IDAT files and uses the <a href="https://www.bioconductor.org/packages/release/bioc/html/crlmm.html"><em>CRLMM</em></a> R-package, together with PLINK to perform genotype calling and data import. The package requires a single sample annotation sheet in the format described in the <a href="DNA%20methylation%20data%20(microarray)">DNA methylation data</a> section. In addition to the column names specified above, a column named <em>GenoSentrixPosition</em> has to be added, which specifies the IDAT file IDs.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="ex">SampleID</span>,age,sex,barcode,GenoSentrixPosition</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="ex">Sample_1</span>,14,f,209054857842_R01C01,9701756058_R05C01</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="ex">Sample_2</span>,42,f,209054857842_R02C01,9701756058_R07C01</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="ex">Sample_3</span>,45,m,209054857842_R03C01,9742011016_R04C01</a></code></pre></div>
<h3 id="imputation">Imputation</h3>
<p>Since Illumina SNP BeadArray data is typically imputed before further analysis, the package integrates a imputation functionality through the <a href="https://imputationserver.sph.umich.edu/index.html#!">Michigan Imputation Server</a>. Using the option setting described below, the package will automatically submit imputation jobs to the server and process the resulting files. In order to be able to perform computation on the server, an account is required. After the account is created, one has to request an API token in the user settings and specify it to <em>MAGAR</em> using the option <code>imputation.user.token</code>. During the imputation process, the package will stall for a while and wait for the job to finish. After the job is completed, the package will prompt for entering the password send via e-mail to the user account. The imputation process has to be split according to chromosomes, which is why multiple e-mails will be send to the account, and the imputation process can take up to several days. However, after imputation, the imputed data will be available as PLINK files, such that the imputation has to be performed only once. For preprocessing the data for upload to the imputation server, the package requires the <a href="http://www.htslib.org/doc/bgzip.html">bgzip</a> and <a href="http://www.htslib.org/doc/tabix.html">tabix</a> tools from the <a href="http://www.htslib.org/">htslib</a> package. Also see further options to configure the imputation jobs at the Michigan Imputation Server <a href="https://imputationserver.readthedocs.io/en/latest/">documentation</a>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">qtlSetOption</span>(</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  <span class="dt">impute.geno.data=</span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  <span class="dt">imputation.reference.panel=</span><span class="st">&quot;apps@hrc-r1.1&quot;</span>,</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">  <span class="dt">imputation.phasing.method=</span><span class="st">&quot;shapeit&quot;</span>,</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">  <span class="dt">imputation.population=</span><span class="st">&quot;eur&quot;</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6">)</a></code></pre></div>
<h2 id="perform-data-import">Perform data import</h2>
<p>The <code>doImport</code> function requires the paths to the respective genotyping and DNA methylation data, as well as a sample annotation sheet as discussed earlier. In this vignette, we will describe the import of DNA methylation data in <em>IDAT</em> format and genotyping data as <em>PLINK</em> files. First, you’ll have to specify the paths to the corresponding <em>IDAT</em> and <em>plink</em> files. Additionally, you have to specify the sample identifier column in the sample annotation sheet that determines the samples in both the genotyping and DNA methylation data. For larger files, we recommend to activate the option to store large matrices on disk rather than in main memory (<code>hdf5dump</code>).</p>
<p>Please note that we provide an accompanying R-package (<a href="https://github.com/MPIIComputationalEpigenetics/methQTL.data">methQTL.data</a>) comprising additional information including microarray annotations and test data sets for this vignette. Furthermore, we provide a patched version of CRLMM that supports the newer Illumina genotyping microarrays (Illumina OmniExome and Illumina OmniExpress) from <a href="https://github.com/MPIIComputationalEpigenetics/crlmm">GitHub</a>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="cf">if</span>(<span class="op">!</span><span class="kw">requireNamespace</span>(<span class="st">&quot;methQTL.data&quot;</span>)){</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">  devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;MPIIComputationalEpigenetics/methQTL-package.data&quot;</span>)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="kw">library</span>(methQTL.data)</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">idat.geno &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>,<span class="dt">package=</span><span class="st">&quot;methQTL.data&quot;</span>)</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">meth.mat &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata/meth_matrix.tsv.gz&quot;</span>,<span class="dt">package=</span><span class="st">&quot;methQTL.data&quot;</span>)</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">anno.sheet &lt;-<span class="st">  </span><span class="kw">system.file</span>(<span class="st">&quot;extdata/sample_annotation.tsv&quot;</span>,<span class="dt">package=</span><span class="st">&quot;methQTL.data&quot;</span>)</a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="kw">qtlSetOption</span>(<span class="dt">hdf5dump=</span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb8-9" data-line-number="9">    <span class="dt">meth.data.type=</span><span class="st">&quot;data.files&quot;</span>,</a>
<a class="sourceLine" id="cb8-10" data-line-number="10">    <span class="dt">geno.data.type=</span><span class="st">&quot;idat&quot;</span>)</a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="kw">options</span>(<span class="dt">fftempdir=</span><span class="st">&quot;tmp/&quot;</span>)</a>
<a class="sourceLine" id="cb8-12" data-line-number="12">imp.data &lt;-<span class="st"> </span><span class="kw">doImport</span>(<span class="dt">data.location =</span> <span class="kw">c</span>(<span class="dt">idat.dir=</span>meth.mat,<span class="dt">geno.dir=</span>idat.geno),</a>
<a class="sourceLine" id="cb8-13" data-line-number="13">                      <span class="dt">s.anno =</span> anno.sheet,</a>
<a class="sourceLine" id="cb8-14" data-line-number="14">                      <span class="dt">s.id.col =</span> <span class="st">&quot;geo_accession&quot;</span>,</a>
<a class="sourceLine" id="cb8-15" data-line-number="15">              <span class="dt">out.folder =</span> <span class="st">&quot;out_dir&quot;</span>,</a>
<a class="sourceLine" id="cb8-16" data-line-number="16">                      <span class="dt">tab.sep =</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb8-17" data-line-number="17">              <span class="dt">idat.platform=</span><span class="st">&quot;humanomni258v1p1b&quot;</span>)</a></code></pre></div>
<p>For imputed data, no further processing is performed on the genotyping data and the dosage values are used as they are:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">idat.dir &lt;-<span class="st"> &quot;idat_dir&quot;</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">geno.dir &lt;-<span class="st"> &quot;geno_dir&quot;</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">anno.sheet &lt;-<span class="st"> &quot;sample_annotation.tsv&quot;</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="kw">qtlSetOption</span>(<span class="dt">hdf5dump=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">imp.data &lt;-<span class="st"> </span><span class="kw">doImport</span>(<span class="dt">data.location =</span> <span class="kw">c</span>(<span class="dt">idat.dir=</span>idat.dir,<span class="dt">geno.dir=</span>geno.dir),</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">                      <span class="dt">s.anno =</span> anno.sheet,</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">                      <span class="dt">s.id.col =</span> <span class="st">&quot;ID&quot;</span>,</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">                      <span class="dt">tab.sep =</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">                      <span class="dt">out.folder =</span> <span class="kw">getwd</span>())</a></code></pre></div>
<p>Please note that the <code>recode.allele.frequencies</code> option specifies, if, according to the cohort analyzed, SNP reference and alternative allele are to be recoded according to the allele frequencies in the available samples. Alternatively, a path to a local version of dbSNP <span class="citation" data-cites="Sherry2001">[@Sherry2001]</span> can be provided through <code>db.snp.ref</code>, and reference/alternative allele information will be automatically parsed from the database. This is especially crucial, if imputation is to be performed, since the Michigan Imputation Server is sensitive to reference mismatches.</p>
<h1 id="methqtl-calling">methQTL calling</h1>
<p>Although <em>MAGAR</em> conceptually splits the methQTL calling into two steps ((i) compute correlation block, (ii) call methQTL per correlation block), only a single function call is needed. The function only requires the input <code>methQTLInput</code> object produced in the previous step, but further options, such as covariates and the p-value cutoff can be directly specified as a function parameter, or as global parameters using <code>?qtlSetOption</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">qtlSetOption</span>(<span class="dt">standard.deviation.gauss=</span><span class="dv">100</span>,</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">    <span class="dt">cluster.cor.threshold=</span><span class="fl">0.75</span>)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">meth.qtl.res &lt;-<span class="st"> </span><span class="kw">doMethQTL</span>(imp.data,<span class="dt">default.options=</span>F,<span class="dt">p.val.cutoff=</span><span class="fl">1e-3</span>)</a></code></pre></div>
<p>We will now present the two steps of the methQTL calling procedure in more detail.</p>
<h2 id="compute-cpg-correlation-blocks">Compute CpG correlation blocks</h2>
<p>Since neighboring CpGs are often highly correlated, using each CpG independently as a potential methQTL candidate leads to many redundant results. We thus aimed to approximate <em>DNA methylation haplotypes</em> by determining highly correlated CpGs in close vicinity. The procedure itself is split into six steps, and is performed for each chromosome independently:</p>
<ol type="1">
<li>Compute the (Pearson) correlation matrix between all CpGs (futher correlation types available in option <code>correlation.type</code>)</li>
<li>Construct the distance matrix from the correlation matrix</li>
<li>Discard all interactions with a correlation lower than a given threshold (option: <code>cluster.cor.threshold</code>)</li>
<li>Weight the distance according to the genomic distance between the two CpGs with a Gaussian (option: <code>standard.deviation.gauss</code>). Higher values for the standard deviation lead to a lower penalty on distal CpGs, thus the clusters will become larger.</li>
<li>Discard all interactions ranging longer than the option <code>absolute.distance.cutoff</code></li>
<li>Compute the Louvain clustering on the undirected, weighted graph induced by the distance matrix</li>
</ol>
<p>This will return a clustering according to the correlation structure between neighboring CpGs that we will later use for methQTL calling. Note that we used simultation experiments to determine the parameters for each data type individually. They will be automatically loaded for the dataset that is used and are:</p>
<ul>
<li><strong>450k:</strong> <code>cluster.cor.threshold</code>=0.2, <code>standard.deviation.gauss</code>=5,000, <code>absolute.distance.cutoff</code>=500,000</li>
<li><strong>EPIC:</strong> <code>cluster.cor.threshold</code>=0.2, <code>standard.deviation.gauss</code>=3,000, <code>absolute.distance.cutoff</code>=500,000</li>
<li><strong>RRBS/WGBS:</strong> <code>cluster.cor.threshold</code>=0.2, <code>standard.deviation.gauss</code>=250, <code>absolute.distance.cutoff</code>=500,000</li>
</ul>
<h2 id="call-methqtl-per-correlation-block">Call methQTL per correlation block</h2>
<p>From the list of correlation blocks, <em>MAGAR</em> computes methQTL interactions with all SNPs on the same chromosome. The process is split into three steps:</p>
<ol type="1">
<li>Compute a representative CpG (tag-CpG) per correlation block, as specified with the option <code>representative.cpg.computation</code> (default: <em>row.medians</em>).</li>
<li>Discard all SNPs that are further than <code>absolute.distance.cutoff</code> (default: 1,000,000) away from the representative CpG</li>
<li>Call methQTL by using linear models. Multiple options of methQTL calling are available and can be selected via the option <code>linear.model.type</code> (default: <em>classical.linear</em>). Alternatively, <em>fastQTL</em> can be set as an option for <code>meth.qtl.type</code>. This will tell the package to use the fastQTL software <span class="citation" data-cites="Ongen2016">[@Ongen2016]</span>.</li>
</ol>
<p>The <code>meth.qtl.type</code> tells, how a methQTL interaction is defined and provides three options, in addition to the already mentioned <em>fastQTL</em>:</p>
<ol type="1">
<li><em>oneVSall</em>: A CpG can only be influenced by one SNP. We choose the one with the lowest p-value.</li>
<li><em>twoVSall</em>: A CpG can both positively and negatively be influenced by two independent SNPs. The package will output those fulfilling the p-value cutoff.</li>
<li><em>allVSall</em>: For each CpG, all SNPs showing a p-value lower than the p-value cutoff will be returned.</li>
</ol>
<p>In the methQTL calling process, potential covariates can be specified using the option <em>sel.covariates</em>. We recommend to include at least <em>age</em> and <em>sex</em> as covariates, as they have a strong influence on the DNA methylation pattern.</p>
<h1 id="downstream-analysis-and-interpretation">Downstream analysis and interpretation</h1>
<h2 id="how-to-use-methqtlresult">How to use <em>methQTLResult</em></h2>
<p>The above procedure will create an object of class <code>methQTLResult</code>, which contains the methQTL that are called in the previous step. To get a table of all the methQTL, you need to extract the information from the object. In the majority of the function calls below, there is the option <code>type</code>, which takes on the values: * ‘SNP’: To characterize the SNPs that influence any DNA methylation state * ‘CpG’: To characterize the representative CpGs per correlation block that are influences by any SNP genotype * ‘cor.block’: To characterize all CpGs, which are part of a correlation block, whose representative CpG is influenced by any genotype</p>
<p>Furthermore, you can obtain genomic annotations for both the CpGs and the SNPs involved in the methQTL interactions:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">result.table &lt;-<span class="st"> </span><span class="kw">getResult</span>(meth.qtl.res)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw">head</span>(result.table)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">anno.meth &lt;-<span class="st"> </span><span class="kw">getAnno</span>(meth.qtl.res,<span class="st">&quot;meth&quot;</span>)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="kw">head</span>(anno.meth)</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">anno.geno &lt;-<span class="st"> </span><span class="kw">getAnno</span>(meth.qtl.res,<span class="st">&quot;geno&quot;</span>)</a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="kw">head</span>(anno.geno)</a></code></pre></div>
<p>For more detailed information about the output, also see the function <code>getResultsGWASMap</code>.</p>
<h2 id="plots">Plots</h2>
<p>To visualize methQTL, <em>MAGAR</em> provides some plotting functions. Most functions return an object of type <code>ggplot</code>, which can be subsequently stored or viewed. Either all methQTL can be simultaneously visualized in a single plot, or a specific methQTL can be visualized:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">result.table &lt;-<span class="st"> </span>result.table[<span class="kw">order</span>(result.table<span class="op">$</span>P.value,<span class="dt">decreasing=</span>F),]</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw">qtlPlotSNPCpGInteraction</span>(imp.data,result.table<span class="op">$</span>CpG[<span class="dv">1</span>],result.table<span class="op">$</span>SNP[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="kw">qtlDistanceScatterplot</span>(meth.qtl.res)</a></code></pre></div>
<h2 id="interpretation-functions">Interpretation functions</h2>
<p>The package provides a bunch of interpretation functions to characterize the detected methQTLs. This includes LOLA enrichment analysis<span class="citation" data-cites="LOLA">[@LOLA]</span> (<code>qtlLOLAEnrichment</code>), genomic annotation enrichment based on putative regulatory elements defined by the Ensembl Regulatory Build<span class="citation" data-cites="Zerbino2015">[@Zerbino2015]</span> (<code>qtlAnnotationEnrichment</code>), enrichment analysis of different base substitutions in SNPs (<code>qtlBaseSubstitutionEnrichment</code>), or TFBS motif enrichment using <a href="http://bioconductor.org/packages/release/bioc/html/TFBSTools.html">TFBSTools</a>. Enrichment is compared for the methQTLs that are available in the provided <code>methQTLResult</code> (for a single input), or to the overlapping QTLs for a list of <code>methQTLResult</code>. The background of the enrichment is defined as all the SNPs/CpGs that have been used as input to the methQTL calling.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">res &lt;-<span class="st"> </span><span class="kw">qtlBaseSubstitutionEnrichment</span>(meth.qtl.res)</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw">qtlPlotBaseSubstitution</span>(meth.qtl.res,<span class="dt">merge=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<h2 id="lists-of-methqtl-results">Lists of methQTL results</h2>
<p>Most of the functions discussed above either support a single <code>methQTLResult</code> as input, or a list of such objects. In case a list is specified, the functions will typically overlap the methQTLs found and compare those with all SNPs/CpGs that have been used for methQTL calling. Additionally, there are functions that particularly work on a list of <code>methQTLResult</code> objects and that perform overlapping, or determine the methQTLs specific to a dataset.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">meth.qtl.list &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">First=</span>meth.qtl.res<span class="fl">.1</span>,<span class="dt">Second=</span>meth.qtl.res<span class="fl">.2</span>,<span class="dt">Third=</span>meth.qtl.res<span class="fl">.3</span>)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="kw">qtlVennPlot</span>(meth.qtl.list)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="kw">qtlUpsetPlot</span>(meth.qtl.list,<span class="dt">type =</span> <span class="st">&quot;cor.block&quot;</span>)</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">spec.first &lt;-<span class="st"> </span><span class="kw">getSpecificQTL</span>(meth.qtl.list<span class="op">$</span>First,meth.qtl.list[<span class="op">-</span><span class="dv">1</span>])</a></code></pre></div>
<h1 id="advanced-configuration">Advanced configuration</h1>
<h2 id="employ-magar-on-a-scientific-compute-cluster">Employ <em>MAGAR</em> on a scientific compute cluster</h2>
<p><em>MAGAR</em> can automatically distribute jobs across a high performance compute cluster, which has been setup using the Sun Grid Engine (SGE) technology. You can pass the option <code>cluster.submit</code> to <code>doMethQTL</code> and thus activate the cluster submission. Note that you’ll also have to specify a path to an executable <em>Rscript</em> and potentially specify resource requirements using the option setting <code>cluster.config</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">qtlSetOption</span>(<span class="dt">cluster.config =</span> <span class="kw">c</span>(<span class="dt">h_vmem=</span><span class="st">&quot;60G&quot;</span>,<span class="dt">mem_free=</span><span class="st">&quot;20G&quot;</span>))</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw">qtlSetOption</span>(<span class="dt">rscript.path =</span> <span class="st">&quot;/usr/bin/Rscript&quot;</span>)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">meth.qtl.res &lt;-<span class="st"> </span><span class="kw">doMethQTL</span>(<span class="dt">meth.qtl =</span> imp.data,</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">                          <span class="dt">cluster.submit =</span> T)</a></code></pre></div>
<h1 id="references">References</h1>
